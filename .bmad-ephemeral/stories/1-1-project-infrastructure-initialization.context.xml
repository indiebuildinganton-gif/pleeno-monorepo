<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1</storyId>
    <title>Project Infrastructure Initialization</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-11-13</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>.bmad-ephemeral/stories/1-1-project-infrastructure-initialization.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>the core project infrastructure and development environment set up</iWant>
    <soThat>I have a working foundation to build features on</soThat>
    <tasks>
- Initialize Turborepo monorepo with multi-zone architecture (AC: 1, 2)
- Set up shared packages structure (AC: 2)
- Configure code quality tools (AC: 2)
- Set up Supabase PostgreSQL database (AC: 1)
- Configure environment variables (AC: 4)
- Set up deployment environment (AC: 1)
- Create basic CI/CD pipeline (AC: 1)
- Install shared dependencies (AC: 1)
- Document setup instructions (AC: 3)
    </tasks>
  </story>

  <acceptanceCriteria>
1. Given I am starting a new project, When I initialize the repository and deployment pipeline, Then I have a working Next.js/React application with TypeScript, a configured PostgreSQL database, basic CI/CD pipeline, and deployment environment

2. And the repository structure follows best practices with clear separation of concerns

3. And all developers can clone, install dependencies, and run the application locally

4. And environment variables are properly configured with example templates
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>Pleeno - System Architecture Document</title>
        <section>Project Initialization</section>
        <snippet>Exact initialization commands for Turborepo monorepo with 6 Next.js zones, Supabase setup, and shared dependencies installation.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Pleeno - System Architecture Document</title>
        <section>Project Structure - Monorepo Architecture</section>
        <snippet>Complete folder structure showing apps/ (6 zones), packages/ (7 shared packages), supabase/, and configuration files.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Pleeno - System Architecture Document</title>
        <section>Decision Summary</section>
        <snippet>Technology stack decisions with versions: Next.js 15.x, TypeScript 5.x, Turborepo, PostgreSQL via Supabase, Zustand, TanStack Query, Shadcn UI, Vitest.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Pleeno - System Architecture Document</title>
        <section>ADR-001: Microfrontend Architecture with Multi-Zones</section>
        <snippet>Decision to use Turborepo with 6 independent Next.js zones for domain isolation, independent deployments, and smaller bundles.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Pleeno - System Architecture Document</title>
        <section>Development Environment - Setup Commands</section>
        <snippet>Complete setup workflow from clone to running all zones: install dependencies, start Supabase, run migrations, generate types, start dev servers.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown - Epic 1</title>
        <section>Story 1.1: Project Infrastructure Initialization</section>
        <snippet>Foundation story establishing Next.js with TypeScript, PostgreSQL database, CI/CD pipeline, and deployment environment with best practices.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>Product Scope - MVP Features</section>
        <snippet>Multi-agency registry with RLS, role-based access, college/student management, payment tracking, automated status updates, and BI dashboard.</snippet>
      </doc>
    </docs>
    <code></code>
    <dependencies>
      <ecosystem name="node">
        <package name="next" version="15.x" purpose="React framework with App Router" />
        <package name="react" version="19" purpose="UI library" />
        <package name="typescript" version="5.x" purpose="Type safety" />
        <package name="@supabase/supabase-js" purpose="Supabase client library" />
        <package name="@supabase/ssr" purpose="Server-side rendering support" />
        <package name="zustand" version="5.0.8" purpose="Client state management" />
        <package name="@tanstack/react-query" version="5.90.7" purpose="Server state and caching" />
        <package name="react-hook-form" version="7.66.0" purpose="Form state management" />
        <package name="@hookform/resolvers" purpose="Form validation" />
        <package name="zod" version="4.x" purpose="Schema validation" />
        <package name="date-fns" version="4.1.0" purpose="Date manipulation" />
        <package name="date-fns-tz" purpose="Timezone support" />
        <package name="recharts" version="3.3.0" purpose="Dashboard charts" />
        <package name="@tanstack/react-table" version="8.21.3" purpose="Data tables" />
        <package name="@react-pdf/renderer" version="4.3.1" purpose="PDF generation" />
        <package name="resend" version="6.4.2" purpose="Email delivery" />
        <package name="tailwindcss" version="4.x" purpose="CSS framework" />
        <package name="turbo" purpose="Monorepo build system" />
        <package name="eslint" purpose="Code linting" />
        <package name="prettier" purpose="Code formatting" />
        <package name="vitest" purpose="Unit testing" />
      </ecosystem>
      <ecosystem name="docker">
        <package name="docker" purpose="Required for local Supabase development" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>CRITICAL: Use Turborepo monorepo architecture with 6 separate Next.js zones (shell, dashboard, agency, entities, payments, reports) - NOT a single Next.js app</constraint>
    <constraint>REQUIRED: Initialize Supabase for PostgreSQL database with RLS multi-tenancy support</constraint>
    <constraint>REQUIRED: Use exact initialization commands from docs/architecture.md Project Initialization section</constraint>
    <constraint>REQUIRED: Create domain-driven migration folder structure in supabase/migrations/ (001_agency_domain/, 002_entities_domain/, etc.)</constraint>
    <constraint>REQUIRED: Set up 7 shared packages in packages/ directory: database, ui, auth, validations, utils, stores, tsconfig</constraint>
    <constraint>REQUIRED: Configure multi-zone rewrites in shell app next.config.js with basePath for each zone</constraint>
    <constraint>REQUIRED: Use TypeScript strict mode for all zones and packages</constraint>
    <constraint>REQUIRED: Install Docker for local Supabase development (npx supabase start requires Docker)</constraint>
    <constraint>REQUIRED: Configure Vercel or Railway deployment with environment variable templates</constraint>
    <constraint>REQUIRED: Set up code quality tools: ESLint, Prettier, Husky pre-commit hooks</constraint>
    <constraint>GREENFIELD: This is a new project from scratch - no existing code to integrate with</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>Supabase Client (packages/database)</name>
      <kind>Database client library</kind>
      <signature>Server client: createServerClient() for Server Components; Client: createBrowserClient() for Client Components</signature>
      <path>packages/database/src/client.ts, packages/database/src/server.ts</path>
    </interface>
    <interface>
      <name>Multi-Zone Navigation</name>
      <kind>Configuration</kind>
      <signature>Shell app rewrites requests to zone apps based on path prefix (e.g., /dashboard/* → dashboard zone on port 3001)</signature>
      <path>apps/shell/next.config.js</path>
    </interface>
    <interface>
      <name>Shared UI Components</name>
      <kind>React component library</kind>
      <signature>Shadcn UI components in packages/ui imported as @pleeno/ui</signature>
      <path>packages/ui/src/components/</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Testing infrastructure will be added in Story 1.4 (Error Handling &amp; Logging Infrastructure). For this story, manual verification is sufficient: clone repository, run npm install, start dev server, verify TypeScript compilation succeeds, and verify deployment pipeline works end-to-end. Unit tests will use Vitest (NOT Jest), component tests with React Testing Library, and E2E tests with Playwright for critical flows.</standards>
    <locations>
      <location>__tests__/e2e/</location>
      <location>packages/*/src/**/*.test.ts</location>
      <location>apps/*/app/**/*.test.tsx</location>
    </locations>
    <ideas>
      <test id="AC1">Verify all 6 Next.js zones start successfully on ports 3000-3005</test>
      <test id="AC1">Verify Supabase local instance starts with Docker and migrations run successfully</test>
      <test id="AC1">Verify TypeScript compilation succeeds with no errors across all zones and packages</test>
      <test id="AC1">Verify deployment pipeline (Vercel/Railway) deploys successfully from main branch</test>
      <test id="AC2">Verify folder structure matches architecture.md specification with apps/, packages/, and supabase/ directories</test>
      <test id="AC3">Verify fresh clone → npm install → npm run dev workflow completes successfully</test>
      <test id="AC4">Verify .env.example contains all required environment variables with placeholder values</test>
      <test id="AC4">Verify .env.local is in .gitignore and not committed to repository</test>
    </ideas>
  </tests>
</story-context>
