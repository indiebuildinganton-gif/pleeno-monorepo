# Story 2-2: # Story 2.2: User Invitation and Task Assignment System
## Task 01: Create database schema for invitations and task assignments

**Story Context:**
- **As a** Agency Admin
- **I want** to invite team members to join my agency and assign them specific tasks
- **So that** I can build my team and flexibly delegate work based on individual needs

**Acceptance Criteria:** 1, 2, 5, 8

**This Task:**
Create database schema for invitations and task assignments

**Subtasks:**
1. Create migration: supabase/migrations/002_agency_domain/004_invitations_schema.sql
2. Define invitations table: id, agency_id, email, token (UUID), expires_at, invited_by, used_at, created_at
3. Define master_tasks table: id, task_name, task_code, description, created_at
4. Define user_task_assignments table: id, user_id, task_id, assigned_at, assigned_by
5. Add unique constraint on invitation token
6. Add foreign key constraints with CASCADE delete
7. Enable RLS on all tables with agency_id filtering
8. Add indexes on commonly queried columns (agency_id, email, token, expires_at)

**Instructions:**

Read the full story context from:
- Story file: .bmad-ephemeral/stories/2-2-user-invitation-and-task-assignment-system.md
- Context file: .bmad-ephemeral/stories/2-2-user-invitation-and-task-assignment-system.context.xml

Then implement this task according to:
1. The acceptance criteria (AC: 1, 2, 5, 8)
2. The Dev Notes section in the story file
3. The Architecture Alignment section
4. The Security Considerations section

**Development Guidelines:**
- Follow the project structure specified in the story
- Use the API route patterns from architecture.md
- Implement RLS policies as specified
- Add appropriate error handling with handleApiError()
- Use Zod validation schemas
- Follow TypeScript best practices
- Add inline comments for complex logic
- Consider security implications at every step

**Testing:**
- Write unit tests for new functions
- Write integration tests for API routes
- Ensure RLS policies are tested
- Test error cases and edge cases

**When Complete:**
- Mark the task checkbox as done in the story file
- Update the manifest file
- Document any deviations or issues encountered
- Note any follow-up tasks discovered

---
*Generated by execute-dev-story-claude-code-web workflow*
