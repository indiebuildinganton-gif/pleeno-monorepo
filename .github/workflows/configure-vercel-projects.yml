name: Configure Vercel Projects

on:
  workflow_dispatch:

jobs:
  configure:
    name: Set Root Directories for Vercel Projects
    runs-on: ubuntu-latest

    steps:
      - name: Configure Dashboard Project
        run: |
          curl -X PATCH "https://api.vercel.com/v9/projects/${{ secrets.VERCEL_PROJECT_ID_DASHBOARD }}" \
            -H "Authorization: Bearer ${{ secrets.VERCEL_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{"rootDirectory": "apps/dashboard"}'
          echo "✓ Configured Dashboard root directory"

      - name: Configure Entities Project
        run: |
          echo "Configuring Entities for pnpm monorepo..."
          curl -X PATCH "https://api.vercel.com/v9/projects/${{ secrets.VERCEL_PROJECT_ID_ENTITIES }}" \
            -H "Authorization: Bearer ${{ secrets.VERCEL_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "rootDirectory": null,
              "installCommand": "pnpm install",
              "buildCommand": "cd apps/entities && pnpm run build",
              "outputDirectory": "apps/entities/.next"
            }'
          echo "✓ Configured Entities for monorepo"

      - name: Configure Payments Project
        run: |
          echo "Configuring Payments for pnpm monorepo..."
          curl -X PATCH "https://api.vercel.com/v9/projects/${{ secrets.VERCEL_PROJECT_ID_PAYMENTS }}" \
            -H "Authorization: Bearer ${{ secrets.VERCEL_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "rootDirectory": null,
              "installCommand": "pnpm install",
              "buildCommand": "cd apps/payments && pnpm run build",
              "outputDirectory": "apps/payments/.next"
            }'
          echo "✓ Configured Payments for monorepo"

      - name: Configure Agency Project
        run: |
          echo "Configuring Agency for pnpm monorepo..."
          curl -X PATCH "https://api.vercel.com/v9/projects/${{ secrets.VERCEL_PROJECT_ID_AGENCY }}" \
            -H "Authorization: Bearer ${{ secrets.VERCEL_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "rootDirectory": null,
              "installCommand": "pnpm install",
              "buildCommand": "cd apps/agency && pnpm run build",
              "outputDirectory": "apps/agency/.next"
            }'
          echo "✓ Configured Agency for monorepo"

      - name: Configure Reports Project
        run: |
          echo "Configuring Reports for pnpm monorepo..."
          curl -X PATCH "https://api.vercel.com/v9/projects/${{ secrets.VERCEL_PROJECT_ID_REPORTS }}" \
            -H "Authorization: Bearer ${{ secrets.VERCEL_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "rootDirectory": null,
              "installCommand": "pnpm install",
              "buildCommand": "cd apps/reports && pnpm run build",
              "outputDirectory": "apps/reports/.next"
            }'
          echo "✓ Configured Reports for monorepo"

      - name: Configure Shell Project
        run: |
          echo "Configuring Shell for pnpm monorepo..."
          curl -X PATCH "https://api.vercel.com/v9/projects/${{ secrets.VERCEL_PROJECT_ID_SHELL }}" \
            -H "Authorization: Bearer ${{ secrets.VERCEL_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "rootDirectory": null,
              "installCommand": "pnpm install",
              "buildCommand": "cd apps/shell && pnpm run build",
              "outputDirectory": "apps/shell/.next"
            }'
          echo "✓ Configured Shell for monorepo"

      - name: Summary
        run: |
          echo "✅ All Vercel projects configured with correct root directories"
          echo ""
          echo "Projects updated:"
          echo "  - Dashboard: apps/dashboard"
          echo "  - Entities: apps/entities"
          echo "  - Payments: apps/payments"
          echo "  - Agency: apps/agency"
          echo "  - Reports: apps/reports"
          echo "  - Shell: apps/shell"
          echo ""
          echo "You can now run deployments and they should work correctly!"
